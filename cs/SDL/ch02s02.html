<?xml version="1.0" encoding="utf-8" standalone="no"?><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Source and destination rectangles</title><link href="epub.css" rel="stylesheet" type="text/css"/><meta content="DocBook XSL Stylesheets V1.75.2" name="generator"/>
<meta name="Adept.resource" value="urn:uuid:db9d31f0-c605-45e5-bd7f-8555ec3e9527"/></head><body id="page"><div class="section" title="Source and destination rectangles"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec15"/>Source and destination rectangles</h1></div></div></div><p>Now that we have something drawn to the screen, it is a good idea to cover the purpose of source and destination rectangles, as they will be extremely important for topics such as tile map loading and drawing. They are also important for sprite sheet animation which we will be covering later in this chapter.</p><p>We can think of a <a class="indexterm" id="id112"/>source rectangle as defining the area we want to copy from a texture onto the window:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In the previous example, we used the entire image so we could simply define the source rectangle's dimensions with the same dimensions as those of the loaded texture.<div class="mediaobject"><img alt="Source and destination rectangles" src="graphics/6821OT_02_03.jpg"/></div></li><li class="listitem">The red box in the preceding screenshot is a visual representation of the source rectangle we used when drawing to the screen. We want to copy pixels from inside the source rectangle to a specific area of the renderer, the destination rectangle<a class="indexterm" id="id113"/> (the red box in the following screenshot).<div class="mediaobject"><img alt="Source and destination rectangles" src="graphics/6821OT_02_04.jpg"/></div></li><li class="listitem">As you would expect, these rectangles can be defined however you wish. For example, let's open up our <code class="literal">Game.cpp</code> file again and take a look at changing the size of the source rectangle. Place this code after the <code class="literal">SDL_QueryTexture</code> function.<div class="informalexample"><pre class="programlisting">m_sourceRectangle.w = 50;
m_sourceRectangle.h = 50;</pre></div><p>Now build again and you should see that only a 50 x 50 square of the image has been copied across to the renderer.</p><div class="mediaobject"><img alt="Source and destination rectangles" src="graphics/6821OT_02_05.jpg"/></div></li><li class="listitem">Now let us move the destination rectangle by changing its <code class="literal">x</code> and <code class="literal">y</code> values.<div class="informalexample"><pre class="programlisting">m_destinationRectangle.x = 100;
m_destinationRectangle.y = 100;</pre></div><p>Build the project <a class="indexterm" id="id114"/>again and you will see that our source rectangle location has remained the same but the destination rectangle has moved. All we have done is move the location that we want the pixels inside the source rectangle to be copied to.</p><div class="mediaobject"><img alt="Source and destination rectangles" src="graphics/6821OT_02_06.jpg"/></div></li><li class="listitem">So far we have left the <a class="indexterm" id="id115"/>source rectangle's <code class="literal">x</code> and <code class="literal">y</code> coordinates at 0 but they can also be moved around to only draw the section of the image that you want. We can move the <code class="literal">x</code> and <code class="literal">y</code> coordinates of the source to draw<a class="indexterm" id="id116"/> the bottom-right section of the image rather than the top-left. Place this code just before where we set the destination rectangle's location.<div class="informalexample"><pre class="programlisting">m_sourceRectangle.x = 50;
m_sourceRectangle.y = 50;</pre></div><p>You can see that we are still drawing to the same destination location but we are copying a different 50 x 50 section of the image.</p><div class="mediaobject"><img alt="Source and destination rectangles" src="graphics/6821OT_02_07.jpg"/></div></li><li class="listitem">We can also pass null into the render copy for either rectangle.<div class="informalexample"><pre class="programlisting">SDL_RenderCopy(m_pRenderer, m_pTexture, 0, 0);</pre></div><p>Passing<a class="indexterm" id="id117"/> null into the<a class="indexterm" id="id118"/> source rectangle parameter will make the renderer use the entire texture. Likewise, passing null to the destination rectangle parameter will use the entire renderer for display.</p><div class="mediaobject"><img alt="Source and destination rectangles" src="graphics/6821OT_02_08.jpg"/></div></li></ol></div><p>We have covered a few different <a class="indexterm" id="id119"/>ways that we can use rectangles to <a class="indexterm" id="id120"/>define areas of images that we would like to draw. We will now put that knowledge into practice by displaying an animated sprite sheet.</p><div class="section" title="Animating a sprite sheet"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec18"/>Animating a sprite sheet</h2></div></div></div><p>We can apply our understanding of source and destination rectangles to the animation of a sprite sheet. A sprite sheet is a series of animation frames all put together into one image. The separate <a class="indexterm" id="id121"/>frames need to have a very specific width and height so that they create a seamless motion. If one part of the sprite <a class="indexterm" id="id122"/>sheet is not correct it will make the whole animation look out of place or completely wrong. Here is an example sprite sheet that we will use for this demonstration:</p><div class="mediaobject"><img alt="Animating a sprite sheet" src="graphics/6821OT_02_09.jpg"/></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">This animation is six frames long and each frame is 128 x 82 pixels. We know from the previous section that we can use a source rectangle to grab a certain part of an image. <a class="indexterm" id="id123"/>Therefore<a class="indexterm" id="id124"/> we can start by defining a source rectangle that encompasses the first frame of the animation only.<div class="mediaobject"><img alt="Animating a sprite sheet" src="graphics/6821OT_02_10.jpg"/></div></li><li class="listitem">Since we know the width, height, and location of the frame on the sprite sheet we can go ahead and hardcode these values into our source rectangle. First we must load the new <code class="literal">animate.bmp</code> file. Place it into your assets folder and alter the loading code.<div class="informalexample"><pre class="programlisting">SDL_Surface* pTempSurface = SDL_LoadBMP("assets/animate.bmp");</pre></div></li><li class="listitem">This will now load our new sprite sheet BMP. We can remove the <code class="literal">SDL_QueryTexture</code> function as we are now defining our own sizes. Alter the size of the source rectangle to only get the first frame of the sheet.<div class="informalexample"><pre class="programlisting">m_sourceRectangle.w = 128;
m_sourceRectangle.h = 82;</pre></div></li><li class="listitem">We will leave the <code class="literal">x</code> and <code class="literal">y</code> position of both rectangles at <code class="literal">0</code> so that we draw the image from the top-left corner and also copy it to the top-left corner of the renderer. We will also leave the dimensions of the destination rectangle as we want it to remain the same as the source rectangle. Pass both rectangles into the <code class="literal">SDL_RenderCopy</code> function:<div class="informalexample"><pre class="programlisting">SDL_RenderCopy(m_pRenderer, m_pTexture, &amp;m_sourceRectangle, &amp;m_destinationRectangle);</pre></div><p>Now when we build we will have the first frame of the animation.</p><div class="mediaobject"><img alt="Animating a sprite sheet" src="graphics/6821OT_02_11.jpg"/></div></li><li class="listitem">Now that we have the first frame, we can move on to animating the sprite sheet. Each frame has<a class="indexterm" id="id125"/> the exact<a class="indexterm" id="id126"/> same dimensions. This is extremely important for this sheet to animate correctly. All we want to do is move the location of the source rectangle, not its dimensions.<div class="mediaobject"><img alt="Animating a sprite sheet" src="graphics/6821OT_02_12.jpg"/></div></li><li class="listitem">Every time we want to move another frame, we simply move the location of the source rectangle and copy it to the renderer. To do this we will use our <code class="literal">update</code> function.<div class="informalexample"><pre class="programlisting">void Game::update()
{
  m_sourceRectangle.x = 128 * int(((SDL_GetTicks() / 100) % 6));
}</pre></div></li><li class="listitem">Here we have used <code class="literal">SDL_GetTicks()</code> to find out the amount of milliseconds since SDL was initialized. We then divide this by the amount of time (in ms) we want between frames and then use the modulo operator to keep it in range of the amount of<a class="indexterm" id="id127"/> frames we have in our animation. This code will (every 100 milliseconds) shift the <code class="literal">x</code> value of our source<a class="indexterm" id="id128"/> rectangle by 128 pixels (the width of a frame), multiplied by the current frame we want, giving us the correct position. Build the project and you should see the animation displayed.</li></ol></div></div><div class="section" title="Flipping images"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec19"/>Flipping images</h2></div></div></div><p>In most games, players, enemies, and so on, will move in more than one direction. To allow the sprite to face in the direction it is moving we will have to flip our sprite sheet. We could of <a class="indexterm" id="id129"/>course create a new row in our sprite sheet with the frames flipped, but this would use more memory, which we do not want. SDL 2.0 has another render function that allows us to pass <a class="indexterm" id="id130"/>in the way we want our image to be flipped or rotated. The function we will use is <code class="literal">SDL_RenderCopyEx</code>. This function takes the same parameters as <code class="literal">SDL_RenderCopy</code> but also takes specific parameters for rotation and flipping. The fourth parameter is the angle we want the image to be displayed with <a class="indexterm" id="id131"/>parameter five being the center point we want for the rotation. The final parameter is an enumerated type called <code class="literal">SDL_RendererFlip</code>.</p><p>The following table shows the available values for the <code class="literal">SDL_RendererFlip</code> enumerated type:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>SDL_RendererFlip value</p>
</th><th style="text-align: left" valign="bottom">
<p>Purpose</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SDL_FLIP_NONE</code>
<a class="indexterm" id="id132"/>
</p>
</td><td style="text-align: left" valign="top">
<p>No flipping</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SDL_FLIP_HORIZONTAL</code>
<a class="indexterm" id="id133"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Flip the texture horizontally</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SDL_FLIP_VERTICAL</code>
<a class="indexterm" id="id134"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Flip the texture vertically</p>
</td></tr></tbody></table></div><p>We can use this parameter to flip our image. Here is the revised render function:</p><div class="informalexample"><pre class="programlisting">void Game::render()
{
  SDL_RenderClear(m_pRenderer);

  SDL_RenderCopyEx(m_pRenderer, m_pTexture,
  &amp;m_sourceRectangle, &amp;m_destinationRectangle,
  0, 0, SDL_FLIP_HORIZONTAL); // pass in the horizontal flip

  SDL_RenderPresent(m_pRenderer);
}</pre></div><p>Build the project and you will see that the image has been flipped and is now facing to the left. Our characters<a class="indexterm" id="id135"/> and enemies will also have frames <a class="indexterm" id="id136"/>specifically for animations such as attack and jump. These can be added to different rows of the sprite sheet and the source rectangle's <code class="literal">y</code> value is incremented accordingly. (We will cover this in more detail when we create our game objects.)</p></div></div></body></html>