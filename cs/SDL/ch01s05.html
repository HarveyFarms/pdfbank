<?xml version="1.0" encoding="utf-8" standalone="no"?><html xmlns="http://www.w3.org/1999/xhtml"><head><title>The Game class</title><link href="epub.css" rel="stylesheet" type="text/css"/><meta content="DocBook XSL Stylesheets V1.75.2" name="generator"/>
<meta name="Adept.resource" value="urn:uuid:db9d31f0-c605-45e5-bd7f-8555ec3e9527"/></head><body id="page"><div class="section" title="The Game class"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>The Game class</h1></div></div></div><p>So, now that we have an idea of <a class="indexterm" id="id67"/>what makes up a game, we can separate the functions into their own class by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Go ahead and create a new file in the project called <code class="literal">Game.h</code>:<div class="informalexample"><pre class="programlisting">#ifndef __Game__
#define __Game__

class Game
{
};

#endif /* defined(__Game__) */</pre></div></li><li class="listitem">Next, we can move our functions from the <code class="literal">main.cpp</code> file into the <code class="literal">Game.h</code> header file:<div class="informalexample"><pre class="programlisting">class Game
{
public:

  Game() {}
  ~Game() {}

  // simply set the running variable to true
  void init() { m_bRunning = true; }    

  void render(){}
  void update(){}
  void handleEvents(){}
  void clean(){}

  // a function to access the private running variable 
  bool running() { return m_bRunning; }

private:

  bool m_bRunning;
};</pre></div></li><li class="listitem">Now, we can alter the <code class="literal">main.cpp</code> file to use this new <code class="literal">Game</code> class:<div class="informalexample"><pre class="programlisting">#include "Game.h"

// our Game object
Game* g_game = 0;

int main(int argc, char* argv[])
{
  g_game = new Game();

  g_game-&gt;init("Chapter 1", 100, 100, 640, 480, 0);

  while(g_game-&gt;running())
  {
    g_game-&gt;handleEvents();
    g_game-&gt;update();
    g_game-&gt;render();
  }
  g_game-&gt;clean();

  return 0;
}</pre></div><p>Our <code class="literal">main.cpp</code> file now does not declare or define any of these functions; it simply<a class="indexterm" id="id68"/> creates an instance of <code class="literal">Game</code> and calls the needed methods.</p></li><li class="listitem">Now that we have this skeleton code, we can go ahead and tie SDL into it to create a window; we will also add a small event handler so that we can exit the application rather than having to force it to quit. We will slightly alter our <code class="literal">Game.h</code> file to allow us to add some SDL specifics and to also allow us to use an implementation file instead of defining functions in the header:<div class="informalexample"><pre class="programlisting">#include "SDL.h"

class Game
{
public:

  Game();
  ~Game();

  void init();

  void render();
  void update();
  void handleEvents();
  void clean();

  bool running() { return m_bRunning; }

private:

  SDL_Window* m_pWindow;
  SDL_Renderer* m_pRenderer;

  bool m_bRunning;
};</pre></div></li></ol></div><p>Looking back at the first part of this chapter (where we created an SDL window), we know that we need a pointer<a class="indexterm" id="id69"/> to an <code class="literal">SDL_Window</code> object that is set when calling <code class="literal">SDL_CreateWindow</code>, and a pointer to an <code class="literal">SDL_Renderer</code> object that is created by passing our window into <code class="literal">SDL_CreateRenderer</code>. The <code class="literal">init</code> function can be extended to use the same parameters as in the initial sample as well. This function will now return a Boolean value so that we can check whether SDL is initialized correctly:</p><div class="informalexample"><pre class="programlisting">bool init(const char* title, int xpos, int ypos, int width, int height, int flags);</pre></div><p>We can now create a new implementation <code class="literal">Game.cpp</code> file in the project so that we can create the definitions for these functions. We can take the code from the <span class="emphasis"><em>Hello SDL</em></span> section and add it to the functions in our new <code class="literal">Game</code> class.</p><p>Open up <code class="literal">Game.cpp</code> and we can begin adding some functionality:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we must include our <code class="literal">Game.h</code> header file:<div class="informalexample"><pre class="programlisting">#include "Game.h"</pre></div></li><li class="listitem">Next, we can define our<a class="indexterm" id="id70"/> <code class="literal">init</code> function; it is essentially the same as the <code class="literal">init</code> function we have previously written in our <code class="literal">main.cpp</code> file:<div class="informalexample"><pre class="programlisting">bool Game::init(const char* title, int xpos, int ypos, int width, int height, int flags)
{
  // attempt to initialize SDL
  if(SDL_Init(SDL_INIT_EVERYTHING) == 0)
  {
    std::cout &lt;&lt; "SDL init success\n";
    // init the window
    m_pWindow = SDL_CreateWindow(title, xpos, ypos, 
    width, height, flags);

    if(m_pWindow != 0) // window init success
    {
      std::cout &lt;&lt; "window creation success\n";
      m_pRenderer = SDL_CreateRenderer(m_pWindow, -1, 0);

      if(m_pRenderer != 0) // renderer init success
      {
        std::cout &lt;&lt; "renderer creation success\n";
        SDL_SetRenderDrawColor(m_pRenderer, 
        255,255,255,255);
      }
      else
      {
        std::cout &lt;&lt; "renderer init fail\n";
        return false; // renderer init fail
      }
    }
    else
    {
      std::cout &lt;&lt; "window init fail\n";
      return false; // window init fail
    }
  }
  else
  {
    std::cout &lt;&lt; "SDL init fail\n";
    return false; // SDL init fail
  }

  std::cout &lt;&lt; "init success\n";
  m_bRunning = true; // everything inited successfully, 
  start the main loop

  return true;
}</pre></div></li><li class="listitem">We will also define<a class="indexterm" id="id71"/> the <code class="literal">render</code> function. It clears the renderer and then renders again with the clear color:<div class="informalexample"><pre class="programlisting">void Game::render()
{
  SDL_RenderClear(m_pRenderer); // clear the renderer to 
  the draw color

  SDL_RenderPresent(m_pRenderer); // draw to the screen
}</pre></div></li><li class="listitem">Finally, we can<a class="indexterm" id="id72"/> clean up. We destroy both the window and the renderer and also call the <code class="literal">SDL_Quit</code> function to close all the subsystems:<div class="informalexample"><pre class="programlisting">{
  std::cout &lt;&lt; "cleaning game\n";
  SDL_DestroyWindow(m_pWindow);
  SDL_DestroyRenderer(m_pRenderer);
  SDL_Quit();
}</pre></div></li></ol></div><p>So we have moved the <code class="literal">Hello SDL 2.0</code> code from the <code class="literal">main.cpp</code> file into a class called <code class="literal">Game</code>. We have freed up the <code class="literal">main.cpp</code> file to handle only the <code class="literal">Game</code> class; it knows nothing about SDL or how the <code class="literal">Game</code> class is implemented. Let's add one more thing to the class to allow us to close the application the regular way:</p><div class="informalexample"><pre class="programlisting">void Game::handleEvents()
{
  SDL_Event event;
  if(SDL_PollEvent(&amp;event))
  {
    switch (event.type)
    {
      case SDL_QUIT:
        m_bRunning = false;
      break;

      default:
      break;
    }
  }
}</pre></div><p>We will cover event handling in more detail in a forthcoming chapter. What this function now does is check if there is an event to handle, and if so, check if it is an <code class="literal">SDL_QUIT</code> event (by clicking on the cross to close a window). If the event is <code class="literal">SDL_QUIT</code>, we set the <code class="literal">Game</code> class' <code class="literal">m_bRunning</code> member <a class="indexterm" id="id73"/>variable to <code class="literal">false</code>. The act of setting this variable to <code class="literal">false</code> makes the main loop stop and the application move onto cleaning up and then exiting:</p><div class="informalexample"><pre class="programlisting">void Game::clean()
{
  std::cout &lt;&lt; "cleaning game\n";
  SDL_DestroyWindow(m_pWindow);
  SDL_DestroyRenderer(m_pRenderer);
  SDL_Quit();
}</pre></div><p>The <code class="literal">clean()</code> function destroys the window and renderer and then calls the <code class="literal">SDL_Quit()</code> function, closing all the initialized SDL subsystems.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note03"/>Note</h3><p>To enable us to view our <code class="literal">std::cout</code> messages, we must first include <code class="literal">Windows.h</code> and then call <code class="literal">AllocConsole(); andfreopen("CON", "w", stdout);</code>. You can do this in the <code class="literal">main.cpp</code> file. Just remember to remove it when sharing your game.</p></div></div><div class="section" title="Fullscreen SDL"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>Fullscreen SDL</h2></div></div></div><p>
<code class="literal">SDL_CreateWindow</code> takes an enumeration value of type <code class="literal">SDL_WindowFlags</code>. These values set how the window will<a class="indexterm" id="id74"/> behave. We created an <code class="literal">init</code> function in our <code class="literal">Game</code> class:</p><div class="informalexample"><pre class="programlisting">bool init(const char* title, int xpos, int ypos, int width, int height, int flags);</pre></div><p>The final parameter is an <code class="literal">SDL_WindowFlags</code> value, which is then passed into the <code class="literal">SDL_CreateWindow</code> function when initializing:</p><div class="informalexample"><pre class="programlisting">// init the window
m_pWindow = SDL_CreateWindow(title, xpos, ypos, width, height, flags);</pre></div><p>Here is a table of the <a class="indexterm" id="id75"/>
<code class="literal">SDL_WindowFlags</code> function:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Flag</p>
</th><th style="text-align: left" valign="bottom">
<p>Purpose</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SDL_WINDOW_FULLSCREEN</code>
<a class="indexterm" id="id76"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Make the window<a class="indexterm" id="id77"/> fullscreen</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SDL_WINDOW_OPENGL</code>
<a class="indexterm" id="id78"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Window can be used<a class="indexterm" id="id79"/> with as an OpenGL context</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SDL_WINDOW_SHOWN</code>
<a class="indexterm" id="id80"/>
</p>
</td><td style="text-align: left" valign="top">
<p>The window is visible<a class="indexterm" id="id81"/>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SDL_WINDOW_HIDDEN</code>
<a class="indexterm" id="id82"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Hide the window<a class="indexterm" id="id83"/>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SDL_WINDOW_BORDERLESS</code>
<a class="indexterm" id="id84"/>
</p>
</td><td style="text-align: left" valign="top">
<p>No border on the window<a class="indexterm" id="id85"/>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SDL_WINDOW_RESIZABLE</code>
<a class="indexterm" id="id86"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Enable resizing<a class="indexterm" id="id87"/> of the window</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SDL_WINDOW_MINIMIZED</code>
<a class="indexterm" id="id88"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Minimize the window<a class="indexterm" id="id89"/>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SDL_WINDOW_MAXIMIZED</code>
<a class="indexterm" id="id90"/>
<a class="indexterm" id="id91"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Maximize the window<a class="indexterm" id="id92"/>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SDL_WINDOW_INPUT_GRABBED</code>
<a class="indexterm" id="id93"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Window has grabbed input focus<a class="indexterm" id="id94"/>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SDL_WINDOW_INPUT_FOCUS</code>
<a class="indexterm" id="id95"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Window has input focus<a class="indexterm" id="id96"/>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SDL_WINDOW_MOUSE_FOCUS</code>
<a class="indexterm" id="id97"/>
</p>
</td><td style="text-align: left" valign="top">
<p>Window has mouse focus<a class="indexterm" id="id98"/>
</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">SDL_WINDOW_FOREIGN</code>
<a class="indexterm" id="id99"/>
</p>
</td><td style="text-align: left" valign="top">
<p>The window <a class="indexterm" id="id100"/>was not created using SDL</p>
</td></tr></tbody></table></div><p>Let's pass in <code class="literal">SDL_WINDOW_FULLSCREEN</code> to the <code class="literal">init</code> function and test out some fullscreen SDL. Open up the <code class="literal">main.cpp</code> file and add this flag:</p><div class="informalexample"><pre class="programlisting">g_game-&gt;init("Chapter 1", 100, 100, 640, 580, SDL_WINDOW_FULLSCREEN))</pre></div><p>Build the application again<a class="indexterm" id="id101"/> and you should see that the window is fullscreen. To exit the application, it will have to be forced to quit (<span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>F4</em></span> on Windows); we will be able to use the keyboard to quit the application in forthcoming chapters, but for now, we won't need fullscreen. One problem we have here is that we have now added something SDL specific to the <code class="literal">main.cpp</code> file. While we will not use any other frameworks in this book, in future we may want to use another. We can remove this SDL-specific flag and replace it with a Boolean value for whether we want fullscreen or not.</p><p>Replace the <a class="indexterm" id="id102"/>
<code class="literal">int flags</code> parameter in our <code class="literal">Game init</code> function with a<a class="indexterm" id="id103"/> <code class="literal">boolfullscreen</code> parameter:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The code snippet for <code class="literal">Game.h</code>:<div class="informalexample"><pre class="programlisting">bool init(const char* title, int xpos, int ypos, int width, int height, bool fullscreen);</pre></div></li><li class="listitem" style="list-style-type: disc">The code snippet for <code class="literal">Game.cpp</code>:<div class="informalexample"><pre class="programlisting">bool Game::init(const char* title, int xpos, int ypos, int width, int height, bool fullscreen)
{
  int flags = 0;

  if(fullscreen)
  {
    flags = SDL_WINDOW_FULLSCREEN;
  }
}</pre></div></li></ul></div><p>We create an <code class="literal">int</code> flags variable to pass into the <a class="indexterm" id="id104"/>
<code class="literal">SDL_CreateWindow</code> function; if we have set <code class="literal">fullscreen</code> to <code class="literal">true</code>, then<a class="indexterm" id="id105"/> this value will be set to the <a class="indexterm" id="id106"/>
<code class="literal">SDL_WINDOW_FULLSCREEN</code> flag, otherwise it will remain as <code class="literal">0</code> to signify that no flags are being used. Let's test this now in our <code class="literal">main.cpp</code> file:</p><div class="informalexample"><pre class="programlisting">if(g_game-&gt;init("Chapter 1", 100, 100, 640, 480, true))</pre></div><p>This will again set our window to fullscreen, but we aren't using the SDL-specific flag to do it. Set it to <code class="literal">false</code> again as we will not need fullscreen for a while. Feel free to try out a few of the other flags to see what effects they have.</p></div></div></body></html>