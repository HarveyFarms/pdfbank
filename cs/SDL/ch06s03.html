<?xml version="1.0" encoding="utf-8" standalone="no"?><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Fitting the factory into the framework</title><link href="epub.css" rel="stylesheet" type="text/css"/><meta content="DocBook XSL Stylesheets V1.75.2" name="generator"/>
<meta name="Adept.resource" value="urn:uuid:db9d31f0-c605-45e5-bd7f-8555ec3e9527"/></head><body id="page"><div class="section" title="Fitting the factory into the framework"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec31"/>Fitting the factory into the framework</h1></div></div></div><p>With our factory now in place, we can start altering our <code class="literal">GameObject</code> classes to use it. Our first step is to ensure that we have a <a class="indexterm" id="id345"/>
<code class="literal">Creator</code> class for each of our objects. Here is one for <code class="literal">Player</code>:</p><div class="informalexample"><pre class="programlisting">class PlayerCreator : public BaseCreator
{
  GameObject* createGameObject() const
  {
    return new Player();
  }
};</pre></div><p>This can be added to the bottom of the <code class="literal">Player.h</code> file. Any object we want the factory to create must have its own <code class="literal">Creator</code> implementation. Another addition we must make is to move <code class="literal">LoaderParams</code> from the constructor to their own function called <code class="literal">load</code>. This stops the need for us to pass the <code class="literal">LoaderParams</code> object to the factory itself. We will put the <code class="literal">load</code> function into the <code class="literal">GameObject</code> base class, as we want every object to have one.</p><div class="informalexample"><pre class="programlisting">class GameObject
{
  public:

  virtual void draw()=0;
  virtual void update()=0;
  virtual void clean()=0;

  // new load function 
  virtual void load(const LoaderParams* pParams)=0;

  protected:

  GameObject() {}
  virtual ~GameObject() {}
};</pre></div><p>Each of our derived classes will now need to implement this <code class="literal">load</code> function. The <code class="literal">SDLGameObject</code> class will now look like this:</p><div class="informalexample"><pre class="programlisting">SDLGameObject::SDLGameObject() : GameObject()
{
}

voidSDLGameObject::load(const LoaderParams *pParams)
{
  m_position = Vector2D(pParams-&gt;getX(),pParams-&gt;getY());
  m_velocity = Vector2D(0,0);
  m_acceleration = Vector2D(0,0);
  m_width = pParams-&gt;getWidth();
  m_height = pParams-&gt;getHeight();
  m_textureID = pParams-&gt;getTextureID();
  m_currentRow = 1;
  m_currentFrame = 1;
  m_numFrames = pParams-&gt;getNumFrames();
}</pre></div><p>Our objects<a class="indexterm" id="id346"/> that derive from <code class="literal">SDLGameObject</code> can use this <code class="literal">load</code> function as well; for example, here is the <code class="literal">Player::load</code> function:</p><div class="informalexample"><pre class="programlisting">Player::Player() : SDLGameObject()
{

}

void Player::load(const LoaderParams *pParams)
{
  SDLGameObject::load(pParams);
}</pre></div><p>This may seem a bit pointless but it actually saves us having to pass through <code class="literal">LoaderParams</code> everywhere. Without it, we would need to pass <code class="literal">LoaderParams</code> through the factory's <code class="literal">create</code> function which would then in turn pass it through to the <code class="literal">Creator</code> object. We have eliminated the need for this by having a specific function that handles parsing our loading values. This will make more sense once we start parsing our states from a file.</p><p>We have another issue which needs rectifying; we have two classes with extra parameters in their constructors (<code class="literal">MenuButton</code> and <code class="literal">AnimatedGraphic</code>). Both classes take an extra parameter as well as <code class="literal">LoaderParams</code>. To combat this we will add these values to <code class="literal">LoaderParams</code> and give them default values.</p><div class="informalexample"><pre class="programlisting">LoaderParams(int x, int y, int width, int height, std::string textureID, int numFrames, int callbackID = 0, int animSpeed = 0) :
m_x(x),
m_y(y),
m_width(width),
m_height(height),
m_textureID(textureID),
m_numFrames(numFrames),
m_callbackID(callbackID),
m_animSpeed(animSpeed)
{

}</pre></div><p>In other words,<a class="indexterm" id="id347"/> if the parameter is not passed in, then the default values will be used (0 in both cases). Rather than passing in a function pointer as <code class="literal">MenuButton</code> did, we are using <code class="literal">callbackID</code> to decide which callback function to use within a state. We can now start using our factory and parsing our states from an XML file.</p></div></body></html>